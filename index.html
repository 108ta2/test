<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒã‚¤ãƒ³ã‚¹ã‚¤ãƒ¼ãƒ‘ãƒ¼ (5x5)</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            color: #333;
            touch-action: manipulation; /* ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã«ã‚ˆã‚‹ã‚ºãƒ¼ãƒ ã‚’ç„¡åŠ¹åŒ– */
        }

        .container {
            background-color: #c0c0c0;
            border: 5px solid #7b7b7b;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            text-align: center;
        }

        h1 {
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.8em;
            color: #333;
        }

        .info-panel {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            font-size: 1em;
            padding: 10px;
            background-color: #bdbdbd;
            border-radius: 5px;
            border: 2px solid #9e9e9e;
        }

        .info-panel span {
            margin: 0 10px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            width: 300px; /* ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚è¦‹ã‚„ã™ã„ã‚ˆã†ã«èª¿æ•´ */
            height: 300px; /* ãƒ¢ãƒã‚¤ãƒ«ã§ã‚‚è¦‹ã‚„ã™ã„ã‚ˆã†ã«èª¿æ•´ */
            border: 3px solid #7b7b7b;
            background-color: #bdbdbd;
            gap: 2px; /* ã‚»ãƒ«é–“ã®éš™é–“ */
        }

        .cell {
            width: 100%;
            height: 100%;
            background-color: #c0c0c0;
            border: 2px outset #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em; /* æ•°å­—ã‚’è¦‹ã‚„ã™ã */
            font-weight: bold;
            cursor: pointer;
            user-select: none; /* ãƒ†ã‚­ã‚¹ãƒˆé¸æŠã‚’ç„¡åŠ¹åŒ– */
            transition: background-color 0.1s ease;
        }

        .cell.revealed {
            background-color: #bdbdbd;
            border: 1px solid #9e9e9e;
        }

        .cell.mine {
            background-color: #ff4136; /* èµ¤è‰² */
            color: white;
        }

        .cell.flagged::before {
            content: "ğŸš©"; /* æ——ã®çµµæ–‡å­— */
            font-size: 1.2em;
        }

        .cell.question::before {
            content: "â“"; /* ï¼Ÿã®çµµæ–‡å­— */
            font-size: 1.2em;
        }

        /* æ•°å­—ã®è‰² */
        .cell.revealed[data-mines="1"] { color: #0000FF; } /* é’ */
        .cell.revealed[data-mines="2"] { color: #008000; } /* ç·‘ */
        .cell.revealed[data-mines="3"] { color: #FF0000; } /* èµ¤ */
        .cell.revealed[data-mines="4"] { color: #000080; } /* ç´º */
        .cell.revealed[data-mines="5"] { color: #800000; } /* èŒ¶ */
        .cell.revealed[data-mines="6"] { color: #008080; } /* ãƒ†ã‚£ãƒ¼ãƒ« */
        .cell.revealed[data-mines="7"] { color: #000000; } /* é»’ */
        .cell.revealed[data-mines="8"] { color: #808080; } /* ç° */


        .message-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: bold;
            display: none; /* åˆæœŸçŠ¶æ…‹ã§ã¯éè¡¨ç¤º */
            border: 2px solid;
        }

        .message-box.win {
            background-color: #d4edda; /* è–„ã„ç·‘ */
            color: #155724; /* æ¿ƒã„ç·‘ */
            border-color: #c3e6cb;
        }

        .message-box.lose {
            background-color: #f8d7da; /* è–„ã„èµ¤ */
            color: #721c24; /* æ¿ƒã„èµ¤ */
            border-color: #f5c6cb;
        }

        .controls {
            margin-top: 20px;
        }

        button {
            font-family: 'Press Start 2P', cursive;
            padding: 12px 25px;
            font-size: 1em;
            background-color: #4CAF50; /* ç·‘ */
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 4px #999;
            transition: background-color 0.2s, box-shadow 0.2s, transform 0.2s;
        }

        button:hover {
            background-color: #45a049;
        }
        button:active {
            background-color: #3e8e41;
            box-shadow: 0 2px #666;
            transform: translateY(2px);
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 400px) {
            .grid-container {
                width: 250px;
                height: 250px;
            }
            .cell {
                font-size: 1em;
            }
            h1 {
                font-size: 1.5em;
            }
            .info-panel {
                font-size: 0.9em;
            }
            button {
                padding: 10px 20px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ãƒã‚¤ãƒ³ã‚¹ã‚¤ãƒ¼ãƒ‘ãƒ¼</h1>
        <div class="info-panel">
            <span id="mines-count">åœ°é›·: 0</span>
            <span id="flags-left">æ——: 0</span>
        </div>
        <div class="grid-container" id="grid"></div>
        <div class="message-box" id="message-box"></div>
        <div class="controls">
            <button id="reset-button">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
    </div>

    <script>
        const GRID_SIZE = 5;
        const NUMBER_OF_MINES = 5; // åœ°é›·ã®æ•°

        const grid = document.getElementById('grid');
        const minesCountDisplay = document.getElementById('mines-count');
        const flagsLeftDisplay = document.getElementById('flags-left');
        const messageBox = document.getElementById('message-box');
        const resetButton = document.getElementById('reset-button');

        let board = []; // ã‚²ãƒ¼ãƒ ç›¤ã®çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹2Dé…åˆ—
        let minesLocations = []; // åœ°é›·ã®å ´æ‰€
        let flagsPlaced = 0;
        let revealedCells = 0;
        let gameOver = false;
        let firstClick = true;

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        resetButton.addEventListener('click', startGame);

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame() {
            // åˆæœŸåŒ–
            board = [];
            minesLocations = [];
            flagsPlaced = 0;
            revealedCells = 0;
            gameOver = false;
            firstClick = true;
            messageBox.style.display = 'none';
            messageBox.className = 'message-box'; // ã‚¯ãƒ©ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
            grid.innerHTML = ''; // ã‚°ãƒªãƒƒãƒ‰ã‚’ã‚¯ãƒªã‚¢

            minesCountDisplay.textContent = `åœ°é›·: ${NUMBER_OF_MINES}`;
            updateFlagsLeftDisplay();

            // ãƒœãƒ¼ãƒ‰ã®ä½œæˆ
            for (let r = 0; r < GRID_SIZE; r++) {
                const row = [];
                for (let c = 0; c < GRID_SIZE; c++) {
                    const cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.dataset.row = r;
                    cell.dataset.col = c;

                    // å·¦ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                    cell.addEventListener('click', () => handleCellClick(cell, r, c));
                    // å³ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ (æ——ã‚’ç«‹ã¦ã‚‹)
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ç„¡åŠ¹åŒ–
                        handleCellRightClick(cell, r, c);
                    });
                    grid.appendChild(cell);
                    row.push({
                        element: cell,
                        isMine: false,
                        isRevealed: false,
                        isFlagged: false,
                        isQuestion: false, // å°†æ¥çš„ã«ã€Œï¼Ÿã€ãƒãƒ¼ã‚¯ç”¨
                        adjacentMines: 0
                    });
                }
                board.push(row);
            }
        }

        // åœ°é›·ã®é…ç½® (æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯å¾Œã«è¡Œã†)
        function placeMines(clickedRow, clickedCol) {
            let minesToPlace = NUMBER_OF_MINES;
            while (minesToPlace > 0) {
                const r = Math.floor(Math.random() * GRID_SIZE);
                const c = Math.floor(Math.random() * GRID_SIZE);

                // æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯ä½ç½®ã¨ãã®å‘¨å›²ã«ã¯åœ°é›·ã‚’ç½®ã‹ãªã„ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
                // ä»Šå›ã¯å˜ç´”åŒ–ã®ãŸã‚ã€æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯ä½ç½®ã«ã®ã¿åœ°é›·ã‚’ç½®ã‹ãªã„
                if (!board[r][c].isMine && !(r === clickedRow && c === clickedCol)) {
                    board[r][c].isMine = true;
                    minesLocations.push({ r, c });
                    minesToPlace--;
                }
            }

            // å„ã‚»ãƒ«ã®éš£æ¥ã™ã‚‹åœ°é›·ã®æ•°ã‚’è¨ˆç®—
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    if (!board[r][c].isMine) {
                        board[r][c].adjacentMines = countAdjacentMines(r, c);
                    }
                }
            }
        }

        // ã‚»ãƒ«ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
        function handleCellClick(cellElement, r, c) {
            if (gameOver || board[r][c].isRevealed || board[r][c].isFlagged) {
                return;
            }

            if (firstClick) {
                placeMines(r, c); // æœ€åˆã®ã‚¯ãƒªãƒƒã‚¯å¾Œã«åœ°é›·ã‚’é…ç½®
                firstClick = false;
            }

            board[r][c].isRevealed = true;
            revealedCells++;
            cellElement.classList.add('revealed');

            if (board[r][c].isMine) {
                revealMines();
                showMessage('ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼', 'lose');
                gameOver = true;
                return;
            }

            if (board[r][c].adjacentMines > 0) {
                cellElement.textContent = board[r][c].adjacentMines;
                cellElement.dataset.mines = board[r][c].adjacentMines; // CSSã§è‰²ä»˜ã‘ã™ã‚‹ãŸã‚
            } else {
                // éš£æ¥ã™ã‚‹åœ°é›·ãŒ0ã®å ´åˆã€å‘¨å›²ã®ã‚»ãƒ«ã‚‚è‡ªå‹•çš„ã«é–‹ã (Flood fill)
                revealAdjacentCells(r, c);
            }

            checkWinCondition();
        }

        // ã‚»ãƒ«å³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç† (æ——)
        function handleCellRightClick(cellElement, r, c) {
            if (gameOver || board[r][c].isRevealed) {
                return;
            }

            if (board[r][c].isFlagged) {
                board[r][c].isFlagged = false;
                cellElement.classList.remove('flagged');
                flagsPlaced--;
            } else if (flagsPlaced < NUMBER_OF_MINES) {
                board[r][c].isFlagged = true;
                cellElement.classList.add('flagged');
                flagsPlaced++;
            }
            updateFlagsLeftDisplay();
        }

        // æ®‹ã‚Šæ——æ•°ã®è¡¨ç¤ºæ›´æ–°
        function updateFlagsLeftDisplay() {
            flagsLeftDisplay.textContent = `æ——: ${NUMBER_OF_MINES - flagsPlaced}`;
        }

        // éš£æ¥ã™ã‚‹åœ°é›·ã®æ•°ã‚’æ•°ãˆã‚‹
        function countAdjacentMines(r, c) {
            let count = 0;
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    if (i === 0 && j === 0) continue; // è‡ªåˆ†è‡ªèº«ã¯æ•°ãˆãªã„
                    const newR = r + i;
                    const newC = c + j;
                    if (isValidCell(newR, newC) && board[newR][newC].isMine) {
                        count++;
                    }
                }
            }
            return count;
        }

        // æœ‰åŠ¹ãªã‚»ãƒ«ã‹ã©ã†ã‹ã‚’åˆ¤å®š
        function isValidCell(r, c) {
            return r >= 0 && r < GRID_SIZE && c >= 0 && c < GRID_SIZE;
        }

        // åœ°é›·ãŒ0ã®ã‚»ãƒ«ã®å‘¨å›²ã‚’å†å¸°çš„ã«é–‹ã (Flood fill)
        function revealAdjacentCells(r, c) {
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    if (i === 0 && j === 0) continue;
                    const newR = r + i;
                    const newC = c + j;

                    if (isValidCell(newR, newC) && !board[newR][newC].isRevealed && !board[newR][newC].isFlagged) {
                        handleCellClick(board[newR][newC].element, newR, newC);
                    }
                }
            }
        }

        // å…¨ã¦ã®åœ°é›·ã‚’è¡¨ç¤ºã™ã‚‹
        function revealMines() {
            minesLocations.forEach(mineLoc => {
                const cell = board[mineLoc.r][mineLoc.c].element;
                if (!board[mineLoc.r][mineLoc.c].isFlagged) { // æ——ãŒç«‹ã£ã¦ã„ãªã„åœ°é›·ã®ã¿è¡¨ç¤º
                    cell.classList.add('mine');
                    cell.textContent = 'ğŸ’£';
                }
            });
            // èª¤ã£ã¦æ——ã‚’ç«‹ã¦ãŸå ´æ‰€ã‚‚è¡¨ç¤º
            for (let r = 0; r < GRID_SIZE; r++) {
                for (let c = 0; c < GRID_SIZE; c++) {
                    if (board[r][c].isFlagged && !board[r][c].isMine) {
                        board[r][c].element.textContent = 'âŒ'; // é–“é•ã„ã®æ——
                        board[r][c].element.style.backgroundColor = '#ffdddd';
                    }
                }
            }
        }

        // å‹åˆ©æ¡ä»¶ã®ç¢ºèª
        function checkWinCondition() {
            const nonMineCells = GRID_SIZE * GRID_SIZE - NUMBER_OF_MINES;
            if (revealedCells === nonMineCells && !gameOver) {
                showMessage('ã‚¯ãƒªã‚¢ï¼ãŠã‚ã§ã¨ã†ï¼', 'win');
                gameOver = true;
                // æ­£ã—ã„æ——ã®è¡¨ç¤º
                minesLocations.forEach(mineLoc => {
                    const cell = board[mineLoc.r][mineLoc.c].element;
                    if (!cell.classList.contains('flagged')) {
                         cell.classList.add('flagged'); // è‡ªå‹•ã§æ——ã‚’ç«‹ã¦ã‚‹
                    }
                });
                updateFlagsLeftDisplay(); // æ——ã®æ•°ã‚’æ›´æ–°
            }
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showMessage(msg, type) {
            messageBox.textContent = msg;
            messageBox.className = 'message-box'; // æ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
            messageBox.classList.add(type); // 'win' ã¾ãŸã¯ 'lose' ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
            messageBox.style.display = 'block';
        }

        // åˆæœŸã‚²ãƒ¼ãƒ é–‹å§‹
        startGame();

        // ãƒ¢ãƒã‚¤ãƒ«ã§ã®é•·æŠ¼ã—ã«ã‚ˆã‚‹æ——ç«‹ã¦ã®ä»£æ›¿ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
        // ç°¡æ˜“çš„ãªå®Ÿè£…ã¨ã—ã¦ã€ã‚¿ãƒƒãƒ—å›æ•°ã§ãƒ•ãƒ©ã‚°ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãªã©ãŒã‚ã‚Šã¾ã™ãŒã€
        // UXã‚’è€ƒæ…®ã™ã‚‹ã¨å°‚ç”¨ã®UIãƒœã‚¿ãƒ³ã‚’è¨­ã‘ã‚‹æ–¹ãŒè‰¯ã„å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚
        // ã“ã“ã§ã¯ã€å³ã‚¯ãƒªãƒƒã‚¯ãŒåŸºæœ¬æ“ä½œã¨ã—ã¦ã„ã¾ã™ã€‚
        // ã‚‚ã—ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œã‚’å¼·åŒ–ã™ã‚‹å ´åˆã¯ã€ã“ã®éƒ¨åˆ†ã‚’æ‹¡å¼µã—ã¦ãã ã•ã„ã€‚
        // ä¾‹:
        // let touchStartTime = 0;
        // cell.addEventListener('touchstart', (e) => {
        //     if (gameOver || board[r][c].isRevealed) return;
        //     touchStartTime = new Date().getTime();
        // });
        // cell.addEventListener('touchend', (e) => {
        //     if (gameOver || board[r][c].isRevealed) return;
        //     const touchEndTime = new Date().getTime();
        //     if (touchEndTime - touchStartTime > 500) { // 500msä»¥ä¸Šã§é•·æŠ¼ã—ã¨åˆ¤å®š
        //         e.preventDefault(); // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚‚ç™ºç«ã™ã‚‹ã®ã‚’é˜²ã
        //         handleCellRightClick(cell, r, c);
        //     }
        // });

    </script>
</body>
</html>

